<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>üíå Valentine?</title>

  <style>
    :root{
      --bg:#070711;
      --text:#f6f6ff;
      --muted:rgba(245,245,255,.72);
      --stroke:rgba(255,255,255,.14);
      --glass:rgba(255,255,255,.08);
      --glass2:rgba(255,255,255,.05);

      --yes:#22c55e;
      --no:#ef4444;

      --radius:26px;
      --shadow:0 30px 90px rgba(0,0,0,.55);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    /* ===== background (optional video) ===== */
    .bg{
      position:fixed; inset:0;
      z-index:-3;
      background:
        radial-gradient(1100px 700px at 25% 15%, rgba(168,85,247,.25), transparent 60%),
        radial-gradient(900px 650px at 80% 55%, rgba(236,72,153,.18), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.80));
    }
    .bg video{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      filter:saturate(1.05) contrast(1.05);
      transform:scale(1.02);
      opacity:.35; /* keep it subtle */
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }

    .shell{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap:18px;
      align-items:stretch;
    }
    @media (max-width: 880px){
      .shell{ grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }

    /* ===== Left: Stories ===== */
    .stories{ padding:14px; }
    .storiesHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:6px 6px 12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logoDot{
      width:10px; height:10px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.2));
      box-shadow: 0 0 0 6px rgba(255,255,255,.06);
    }
    .brandName{
      font-weight:900;
      letter-spacing:.2px;
      font-size:14px;
      color:rgba(255,255,255,.92);
    }
    .chip{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      color:rgba(255,255,255,.80);
      white-space:nowrap;
    }

    .frame{
      position:relative;
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      aspect-ratio: 9 / 16;
      max-height: 76vh;
      width:100%;
    }

    .progress{
      position:absolute;
      top:10px; left:10px; right:10px;
      display:flex; gap:7px;
      z-index:10;
      pointer-events:none;
    }
    .bar{
      flex:1; height:3px;
      border-radius:999px;
      background: rgba(255,255,255,.20);
      overflow:hidden;
    }
    .bar span{
      display:block; height:100%; width:0%;
      background: rgba(255,255,255,.92);
      transform-origin:left;
    }

    .overlayTop{
      position:absolute;
      top:18px; left:14px; right:14px;
      display:flex; justify-content:space-between; align-items:center;
      z-index:11;
      pointer-events:none;
    }
    .tag{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.16);
      color:rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
    }

    .rail{
      height:100%;
      display:flex;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch;
      scroll-behavior:smooth;
    }
    .rail::-webkit-scrollbar{ display:none; }

    .slide{
      flex:0 0 100%;
      height:100%;
      position:relative;
      scroll-snap-align:start;
      background: rgba(0,0,0,.08);
    }
    .media{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      background: rgba(0,0,0,.2);
    }

    .tapzone{
      position:absolute; top:0; bottom:0;
      width:50%;
      z-index:12;
    }
    .tapzone.left{ left:0; }
    .tapzone.right{ right:0; }

    .fsBtn{
      position:absolute;
      right:12px; bottom:12px;
      z-index:13;
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.16);
      color:#fff;
      border-radius:14px;
      padding:8px 10px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    :fullscreen .fsBtn{ display:none; }

    .playHint{
      margin-top:10px;
      font-size:12px;
      color:rgba(255,255,255,.72);
      text-align:center;
      display:none;
    }

    /* ===== Right: Content ===== */
    .content{
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .hero h1{
      margin:0;
      font-size:28px;
      letter-spacing:.2px;
      line-height:1.15;
    }
    .hero p{
      margin:10px 0 0;
      color:var(--muted);
      line-height:1.55;
    }

    .box{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius:20px;
      padding:16px;
    }
    .kicker{
      font-size:12px;
      color:rgba(255,255,255,.78);
      margin-bottom:10px;
      letter-spacing:.2px;
    }
    .storyText{
      margin:0;
      font-size:16px;
      line-height:1.65;
      color:rgba(255,255,255,.94);
      white-space:pre-line;
    }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top:12px;
    }
    .pill{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      color:rgba(255,255,255,.82);
      white-space:nowrap;
    }

    .btn{
      border:0;
      border-radius:16px;
      padding:12px 16px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      transition: transform .06s ease, filter .15s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .nextBtn{
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.92);
    }

    .questionWrap{ display:none; }
    .q{
      font-size:20px;
      font-weight:1000;
      margin:0 0 14px;
      letter-spacing:.1px;
    }
    .btns{ display:flex; gap:12px; flex-wrap:wrap; }
    .yes{ background: var(--yes); color:#06210e; }
    .no{ background: var(--no); color:#2a0606; }

    .small{
      font-size:13px;
      color:rgba(245,245,255,.75);
      margin-top:10px;
      min-height:18px;
    }

    .result{
      margin-top:14px;
      border-radius:18px;
      padding:14px;
      display:none;
      background: rgba(34,197,94,.12);
      border: 1px solid rgba(34,197,94,.25);
    }
    .resultTitle{
      font-weight:1000;
      font-size:18px;
      margin-bottom:8px;
    }
    .meet{
      color:rgba(255,255,255,.95);
      line-height:1.55;
    }
    .meet a{ color:#a7f3d0; font-weight:900; text-decoration:none; }
    .meet a:hover{ text-decoration:underline; }

    .foot{
      margin-top:auto;
      padding-top:8px;
      font-size:12px;
      color:rgba(255,255,255,.52);
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="bg">
    <!-- Optional: put bg.mp4 in repo root. If missing, it just won‚Äôt show -->
    <video autoplay muted loop playsinline preload="metadata" id="bgVideo">
      <source src="bg.mp4" type="video/mp4">
    </video>
  </div>

  <main class="wrap">
    <section class="shell">

      <!-- LEFT: Stories -->
      <div class="panel stories">
        <div class="storiesHeader">
          <div class="brand">
            <span class="logoDot"></span>
            <div class="brandName">Memories</div>
          </div>
          <div class="chip">Tap ‚Ä¢ Swipe ‚Ä¢ Hold</div>
        </div>

        <div class="frame" id="frame">
          <div class="progress" id="progress"></div>

          <div class="overlayTop">
            <div class="tag" id="storyTag">üíó</div>
            <div class="tag" id="storyCount">1 / 1</div>
          </div>

          <div class="rail" id="rail"></div>

          <button class="fsBtn" id="fsBtn" type="button">‚õ∂</button>
          <div class="tapzone left" data-nav="prev"></div>
          <div class="tapzone right" data-nav="next"></div>
        </div>

        <div class="playHint" id="playHint">If a video doesn‚Äôt play on Safari, it‚Äôs usually the codec (export as H.264 MP4).</div>
      </div>

      <!-- RIGHT: Storyline + Question -->
      <div class="panel content">
        <div class="hero">
          <h1 id="heroTitle">Hey you üëÄ</h1>
          <p id="heroSub">I made this little page because‚Ä¶ you‚Äôve been on my mind. A lot.</p>
        </div>

        <div class="box" id="storyBox">
          <div class="kicker" id="kicker">A tiny story‚Ä¶</div>
          <p class="storyText" id="storyText"></p>

          <div class="row">
            <span class="pill" id="pagePill">1 / 4</span>
            <button class="btn nextBtn" id="nextBtn" type="button">Next ‚ûú</button>
          </div>
        </div>

        <div class="box questionWrap" id="questionWrap">
          <div class="q" id="q">Will you be my Valentine? üíå</div>

          <div class="btns">
            <button class="btn yes" id="yesBtn" type="button">Yes ‚ù§Ô∏è</button>
            <button class="btn no" id="noBtn" type="button">No üôÉ</button>
          </div>

          <div class="small" id="hint"></div>

          <div class="result" id="result">
            <div class="resultTitle">Yessss! üéâüíò</div>
            <div class="meet" id="meetText"></div>
            <div class="small">Opening WhatsApp‚Ä¶ üòå</div>
          </div>
        </div>

        <div class="foot">Made with ‚ù§Ô∏è (and a little courage)</div>
      </div>

    </section>
  </main>

  <script>
    // ==========================
    // 1) MEDIA (repo root paths)
    // ==========================
    const MEDIA = [
      { type: "image", src: "first1.jpeg", label: "üíó" },
      { type: "image", src: "first2.jpeg", label: "üíó" },
      { type: "image", src: "first3.jpeg", label: "üíó" },
      { type: "image", src: "last1.jpg",  label: "üíó" },
      { type: "image", src: "last2.jpg",  label: "üíó" },

      // Videos
      { type: "video", src: "v2first.mp4",  label: "üé¨", mutedAutoplay: true  },
      { type: "video", src: "v2second.mp4", label: "üé¨", mutedAutoplay: true  },
      { type: "video", src: "v31.mp4",      label: "üé¨", mutedAutoplay: false },
      { type: "video", src: "v32.mp4",      label: "üé¨", mutedAutoplay: false }
    ];

    // ==========================
    // 2) Stories build + logic
    // ==========================
    const rail = document.getElementById("rail");
    const progress = document.getElementById("progress");
    const storyTag = document.getElementById("storyTag");
    const storyCount = document.getElementById("storyCount");
    const playHint = document.getElementById("playHint");
    const frame = document.getElementById("frame");
    const fsBtn = document.getElementById("fsBtn");

    function buildSlides(){
      rail.innerHTML = "";
      MEDIA.forEach((m) => {
        const s = document.createElement("div");
        s.className = "slide";
        s.dataset.type = m.type;

        if (m.type === "image") {
          const img = document.createElement("img");
          img.className = "media";
          img.src = m.src;
          img.alt = "memory";
          s.appendChild(img);
        } else {
          const v = document.createElement("video");
          v.className = "media";
          v.setAttribute("playsinline", "");
          v.setAttribute("webkit-playsinline", "");
          v.preload = "metadata";
          v.loop = true;

          // Safari rules: autoplay requires muted
          v.muted = !!m.mutedAutoplay;
          v.controls = !m.mutedAutoplay;
          if (m.mutedAutoplay) v.autoplay = true;

          const src = document.createElement("source");
          src.src = m.src;
          src.type = "video/mp4";
          v.appendChild(src);

          s.appendChild(v);
        }

        rail.appendChild(s);
      });

      // progress bars
      progress.innerHTML = MEDIA.map(() => `<div class="bar"><span></span></div>`).join("");
      storyCount.textContent = `1 / ${MEDIA.length}`;
      storyTag.textContent = MEDIA[0]?.label || "üíó";
    }

    buildSlides();

    const slides = () => Array.from(rail.querySelectorAll(".slide"));
    const bars = () => Array.from(progress.querySelectorAll(".bar span"));

    let idx = 0;
    let running = false;
    let hold = false;
    let rafId = null;
    let barStart = 0;
    let barDuration = 3500;

    const durationFor = (i) => (slides()[i]?.dataset.type === "video" ? 6500 : 3500);

    function setActiveUI(){
      storyCount.textContent = `${idx + 1} / ${MEDIA.length}`;
      storyTag.textContent = MEDIA[idx]?.label || "üíó";
      bars().forEach((b, i) => b.style.width = (i < idx ? "100%" : "0%"));
    }

    function pauseAllVideos(){
      slides().forEach(s => {
        const v = s.querySelector("video");
        if (v && !v.paused) v.pause();
      });
    }

    async function tryPlayActiveVideo(){
      const s = slides()[idx];
      const v = s?.querySelector("video");
      if (!v) return;

      // only try autoplay videos
      if (!v.autoplay) return;

      try{
        await v.play();
        playHint.style.display = "none";
      }catch(e){
        v.controls = true;
        playHint.style.display = "block";
      }
    }

    function setIndexFromScroll(){
      const w = rail.clientWidth || 1;
      const i = Math.round(rail.scrollLeft / w);
      idx = Math.max(0, Math.min(MEDIA.length - 1, i));
    }

    function stopAnim(){
      running = false;
      if (rafId) cancelAnimationFrame(rafId);
      rafId = null;
    }

    function goTo(i){
      idx = (i + MEDIA.length) % MEDIA.length;
      rail.scrollTo({ left: rail.clientWidth * idx, behavior: "smooth" });
      restart();
    }

    function tick(t){
      if (!running) return;
      if (hold) { rafId = requestAnimationFrame(tick); return; }

      const p = Math.min(1, (t - barStart) / barDuration);
      const b = bars()[idx];
      if (b) b.style.width = (p * 100).toFixed(2) + "%";

      if (p >= 1) goTo(idx + 1);
      else rafId = requestAnimationFrame(tick);
    }

    function start(){
      if (running) return;
      running = true;

      setActiveUI();
      barDuration = durationFor(idx);
      barStart = performance.now();
      rafId = requestAnimationFrame(tick);

      pauseAllVideos();
      tryPlayActiveVideo();
    }

    function restart(){ stopAnim(); start(); }

    // scroll sync
    let scrollT = null;
    rail.addEventListener("scroll", () => {
      setIndexFromScroll();
      clearTimeout(scrollT);
      scrollT = setTimeout(() => restart(), 110);
    });

    // tap zones
    frame.addEventListener("click", (e) => {
      if (e.target.closest("video") || e.target.closest("button")) return;
      const nav = e.target.closest(".tapzone")?.dataset.nav;
      if (nav === "prev") goTo(idx - 1);
      if (nav === "next") goTo(idx + 1);
    });

    // hold to pause
    frame.addEventListener("touchstart", () => { hold = true; }, { passive:true });
    frame.addEventListener("touchend", () => { hold = false; }, { passive:true });
    frame.addEventListener("mousedown", () => { hold = true; });
    frame.addEventListener("mouseup", () => { hold = false; });

    // tap video to play if blocked
    frame.addEventListener("pointerdown", async (e) => {
      const v = e.target.closest("video");
      if (!v) return;
      try{ await v.play(); playHint.style.display = "none"; }catch(_){}
    }, true);

    // fullscreen
    fsBtn.addEventListener("click", (e) => {
      e.preventDefault(); e.stopPropagation();
      if (frame.requestFullscreen) frame.requestFullscreen();
      else if (frame.webkitRequestFullscreen) frame.webkitRequestFullscreen();
    });

    start();

    // ==========================
    // 3) Storyline flow
    // ==========================
    const heroTitle = document.getElementById("heroTitle");
    const heroSub = document.getElementById("heroSub");
    const kicker = document.getElementById("kicker");
    const storyText = document.getElementById("storyText");
    const pagePill = document.getElementById("pagePill");
    const nextBtn = document.getElementById("nextBtn");
    const storyBox = document.getElementById("storyBox");
    const questionWrap = document.getElementById("questionWrap");

    const storySteps = [
      {
        heroTitle: "Hey you üëÄ",
        heroSub: "Just give me 10 seconds.",
        kicker: "A small thing",
        text: `I made this because you‚Äôve been on my mind.
Not in a loud way‚Ä¶
in that quiet ‚ÄúI miss you‚Äù type of way üòå`
      },
      {
        heroTitle: "You‚Äôre different",
        heroSub: "And I like that.",
        kicker: "My favorite parts",
        text: `The way you tease me.
The way you feed me.
The way you make normal moments feel like something special.`
      },
      {
        heroTitle: "So‚Ä¶",
        heroSub: "I‚Äôm done pretending it‚Äôs small.",
        kicker: "One question",
        text: `I have one important question for you‚Ä¶`
      },
      {
        heroTitle: "Okay üòÑ",
        heroSub: "No running.",
        kicker: "Ready?",
        text: `Click next.`
      }
    ];

    let step = 0;

    function renderStep(){
      const s = storySteps[step];
      heroTitle.textContent = s.heroTitle;
      heroSub.textContent = s.heroSub;
      kicker.textContent = s.kicker;
      storyText.textContent = s.text;
      pagePill.textContent = `${step + 1} / ${storySteps.length}`;
    }

    nextBtn.addEventListener("click", () => {
      if (step < storySteps.length - 1){
        step++;
        renderStep();
      } else {
        storyBox.style.display = "none";
        questionWrap.style.display = "block";
      }
    });

    renderStep();

    // ==========================
    // 4) Valentine + WhatsApp
    // ==========================
    const meetup = {
      title: "Meet me at: Caf√© Bar Noire",
      time: "Time: 9:00pm",
      note: "Dress code: Maximum Exposure üòç",
      mapsUrl: "https://maps.app.goo.gl/K8G3oa5vZDsc2ncR6"
    };

    const YOUR_WA = "233550340429";
    const WA_MESSAGE = "I just said YES ‚ù§Ô∏èü•∞ See you on Valentine‚Äôs Day!";

    const qEl = document.getElementById("q");
    const hintEl = document.getElementById("hint");
    const resultEl = document.getElementById("result");
    const meetTextEl = document.getElementById("meetText");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");

    const noQuestions = [
      "Are you sure? ü•∫",
      "What if I bath today? üò≠",
      "What if I buy you kenkey? üòôüòô",
      "Be honest‚Ä¶ you‚Äôre smiling right now üòå",
      "Alright, choose wisely‚Ä¶ üíò"
    ];

    let noCount = 0;

    function showMeetupAndWhatsApp(){
      qEl.textContent = "Best decision ever üòåüíñ";
      hintEl.textContent = "";
      noBtn.style.display = "none";
      yesBtn.textContent = "Yay!! üíÉüèΩ";
      resultEl.style.display = "block";

      const safeMaps = meetup.mapsUrl && meetup.mapsUrl.startsWith("http") ? meetup.mapsUrl : "";
      meetTextEl.innerHTML = `
        <div><strong>${meetup.title}</strong></div>
        <div>${meetup.time}</div>
        ${meetup.note ? `<div>${meetup.note}</div>` : ``}
        ${safeMaps ? `<div style="margin-top:10px;">üìç <a href="${safeMaps}" target="_blank" rel="noopener">Open location in Maps</a></div>` : ``}
      `;

      const wa = `https://wa.me/${YOUR_WA}?text=${encodeURIComponent(WA_MESSAGE)}`;
      setTimeout(() => { window.location.href = wa; }, 900);
    }

    yesBtn.addEventListener("click", showMeetupAndWhatsApp);

    noBtn.addEventListener("click", () => {
      qEl.textContent = noQuestions[Math.min(noCount, noQuestions.length - 1)];
      hintEl.textContent = noCount < 2 ? "No pressure‚Ä¶ but also‚Ä¶ pressure üòá" : "You can‚Äôt escape love üòåüíò";

      const dx = Math.floor(Math.random() * 120) - 60;
      const dy = Math.floor(Math.random() * 60) - 30;
      noBtn.style.transform = `translate(${dx}px, ${dy}px)`;

      const scale = 1 + Math.min(0.6, (noCount + 1) * 0.08);
      yesBtn.style.transform = `scale(${scale})`;

      noCount++;
    });

    // background video fallback
    const bgVideo = document.getElementById("bgVideo");
    if (bgVideo){
      bgVideo.addEventListener("error", () => { bgVideo.style.display = "none"; });
    }
  </script>
</body>
</html>
